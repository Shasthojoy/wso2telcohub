<!-- SubscriptionApprovalWorkFlowProcess BPEL Process [Generated by the Eclipse 
	BPEL Designer] -->
<!-- Date: Mon Mar 05 12:18:58 IST 2012 -->

<bpel:process name="SubscriptionApprovalWorkFlowProcess"
	targetNamespace="http://workflow.subscription.apimgt.carbon.wso2.org"
	suppressJoinFailure="yes"
	xmlns:tns="http://workflow.subscription.apimgt.carbon.wso2.org"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803"
	xmlns:ns1="http://org.wso2.carbon/subscriptions/" 
	xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org"
	xmlns:axau="http://org.wso2.carbon/axiata/workflow/audit"
	xmlns:axnotify="http://org.wso2.carbon/axiata/workflow/notify">
	
	<!-- Import the client WSDL -->
	<bpel:extensions>
		<bpel:extension
			namespace="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803"
			mustUnderstand="yes"></bpel:extension>
	</bpel:extensions>
	<bpel:import namespace="http://callback.workflow.apimgt.carbon.wso2.org"
		location="WorkflowCallbackService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://org.wso2.carbon/subscriptions/"
		location="SubscriptionsApprovalTaskService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="SubscriptionApprovalWorkFlowProcessArtifacts.wsdl"
		namespace="http://workflow.subscription.apimgt.carbon.wso2.org"
		importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import namespace="http://org.wso2.carbon/axiata/workflow/audit"
		location="AxiataWorkflowApprovalAuditService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://org.wso2.carbon/axiata/workflow/notify"
		location="AxiataWorkflowNotificationService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. It is 
			used for callback. The location and correlation information associated with 
			the client role are automatically set using WS-Addressing. -->
		<bpel:partnerLink name="client"
			partnerLinkType="tns:SubscriptionApprovalWorkFlowProcess" myRole="SubscriptionApprovalWorkFlowProcessProvider" />
		<bpel:partnerLink name="SAPL" partnerLinkType="tns:SAPLT"
			myRole="role2" partnerRole="role1"></bpel:partnerLink>
		<bpel:partnerLink name="CBPL" partnerLinkType="tns:CBPLT"
			partnerRole="role3"></bpel:partnerLink>
		<bpel:partnerLink name="AAUPL" partnerLinkType="tns:AAUPLT"
			partnerRole="axiataAuditRole" initializePartnerRole="yes"></bpel:partnerLink>
		<bpel:partnerLink name="AXNOTIFYPL" partnerLinkType="tns:AXNOTIFYPLT"
			partnerRole="axiataNotifyRole" initializePartnerRole="yes"></bpel:partnerLink>
		</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input" messageType="ns1:SubscriptionApprovalRequest" />

		<!-- Reference to the message that will be sent back to the requester during 
			callback -->
		<bpel:variable name="output" messageType="ns1:SubscriptionApprovalResponse" />
		<bpel:variable name="input_ht" messageType="ns1:SubscriptionApprovalRequest"></bpel:variable>
		<bpel:variable name="output_ht" messageType="ns1:SubscriptionApprovalResponse"></bpel:variable>
		<bpel:variable name="clientRequest"
			messageType="tns:SubscriptionApprovalWorkFlowProcessRequestMessage"></bpel:variable>

		<bpel:variable name="input_to_response" messageType="ns:resumeEventRequest"></bpel:variable>
		<bpel:variable name="input_sub_approval_audit" messageType="axau:SubApprovalAuditRequest"></bpel:variable>
		<bpel:variable name="input_plugin_approver_email_notification" messageType="axnotify:PLUGINAdminSubApprovalEmailNotificationRequest" />
		<bpel:variable name="input_approval_status_sp_email_notification" messageType="axnotify:SubApprovalStatusSPEmailNotificationRequest" />

	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requestor. Note: This maps to operation defined 
			in SubscriptionApprovalWorkFlowProcess.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			createInstance="yes" operation="initiate"
			portType="tns:SubscriptionApprovalWorkFlowProcess" variable="clientRequest" />
		
		<bpel:assign validate="no" name="assign_plugin_approver_email_notification">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<axnotify:PLUGINAdminSubApprovalEmailNotificationRequest
							xmlns:axnotify="http://org.wso2.carbon/axiata/workflow/notify"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<axnotify:receiverRole>axnotify:receiverRole</axnotify:receiverRole>
							<axnotify:apiName>axnotify:apiName</axnotify:apiName>
							<axnotify:apiVersion>axnotify:apiVersion</axnotify:apiVersion>
							<axnotify:apiContext>axnotify:apiContext</axnotify:apiContext>
							<axnotify:apiProvider>axnotify:apiProvider</axnotify:apiProvider>
							<axnotify:subscriber>axnotify:subscriber</axnotify:subscriber>
							<axnotify:subscriptionTier>axnotify:subscriptionTier</axnotify:subscriptionTier>
							<axnotify:applicationName>axnotify:applicationName</axnotify:applicationName>
							<axnotify:applicationDescription>axnotify:applicationDescription</axnotify:applicationDescription>
						</axnotify:PLUGINAdminSubApprovalEmailNotificationRequest>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="input_plugin_approver_email_notification" part="PLUGINAdminSubApprovalEmailNotificationRequest"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProviderRole]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:receiverRole]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiVersion]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiContext]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiProvider]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriber]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tierName]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriptionTier]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
				</bpel:from>
				<bpel:to part="PLUGINAdminSubApprovalEmailNotificationRequest" variable="input_plugin_approver_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:invoke name="invoke_plugin_approver_email_notification"
			partnerLink="AXNOTIFYPL" operation="sendPLUGINAdminSubApprovalEmailNotification" portType="axnotify:AxiataWorkflowNotificationServicePT"
			inputVariable="input_plugin_approver_email_notification">
		</bpel:invoke>
		
		<bpel:assign validate="no" name="assign_input">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<tschema:SubscriptionApprovalData
							xmlns:tschema="http://workflow.subscription.apimgt.carbon.wso2.org"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<tschema:apiName>tschema:apiName</tschema:apiName>
							<tschema:apiVersion>tschema:apiVersion</tschema:apiVersion>
							<tschema:apiContext>tschema:apiContext</tschema:apiContext>
							<tschema:apiProvider>tschema:apiProvider</tschema:apiProvider>
							<tschema:subscriber>tschema:subscriber</tschema:subscriber>
							<tschema:applicationName>tschema:applicationName
							</tschema:applicationName>
							<tschema:tierName>tschema:tierName</tschema:tierName>
							<tschema:callBackURL>tschema:callBackURL</tschema:callBackURL>
							<tschema:workflowExternalRef>tschema:workflowExternalRef
							</tschema:workflowExternalRef>
							<tschema:applicationDescription>tschema:applicationDescription
							</tschema:applicationDescription>

						</tschema:SubscriptionApprovalData>
					</bpel:literal>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest"></bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht"></bpel:to>
			</bpel:copy>
		</bpel:assign>

		<!-- Asynchronous callback to the requester. Note: the callback location 
			and correlation id is transparently handled using WS-addressing. -->
		<bpel:extensionActivity>
			<b4p:peopleActivity name="subscription_approve"
				inputVariable="input_ht" outputVariable="output_ht">
				<b4p:remoteTask partnerLink="SAPL" operation="approve"
					responseOperation="approvalResponse"></b4p:remoteTask>
			</b4p:peopleActivity>
		</bpel:extensionActivity>
		<bpel:assign validate="no" name="assign_output">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<ns:resumeEvent xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<ns:workflowReference>ns:workflowReference</ns:workflowReference>
							<ns:status>ns:status</ns:status>
							<ns:description>ns:description</ns:description>

						</ns:resumeEvent>
					</bpel:literal>
				</bpel:from>
				<bpel:to part="parameters" variable="input_to_response"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:workflowExternalRef]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="input_to_response">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns:workflowReference]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:status]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="input_to_response">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns:status]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:description]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="input_to_response">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns:description]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:invoke name="Invoke" partnerLink="CBPL" operation="resumeEvent"
			portType="ns:WorkflowCallbackServicePortType" inputVariable="input_to_response">
		</bpel:invoke>
		
		<!-- [START] Trigger email notification to the SP with the Sub approval status. -->
		
		<bpel:assign validate="no" name="assign_approval_status_sp_email_notification">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<axnotify:SubApprovalStatusSPEmailNotificationRequest
							xmlns:axnotify="http://org.wso2.carbon/axiata/workflow/notify"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<axnotify:apiName>axnotify:apiName</axnotify:apiName>
							<axnotify:apiVersion>axnotify:apiVersion</axnotify:apiVersion>
							<axnotify:apiContext>axnotify:apiContext</axnotify:apiContext>
							<axnotify:apiProvider>axnotify:apiProvider</axnotify:apiProvider>
							<axnotify:subscriber>axnotify:subscriber</axnotify:subscriber>
							<axnotify:subscriptionTier>axnotify:subscriptionTier</axnotify:subscriptionTier>
							<axnotify:applicationName>axnotify:applicationName</axnotify:applicationName>
							<axnotify:applicationDescription>axnotify:applicationDescription</axnotify:applicationDescription>
							<axnotify:approvalStatus>axnotify:approvalStatus</axnotify:approvalStatus>
						</axnotify:SubApprovalStatusSPEmailNotificationRequest>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="input_approval_status_sp_email_notification" part="SubApprovalStatusSPEmailNotificationRequest"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiVersion]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiContext]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiProvider]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriber]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriptionTier]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalStatusSPEmailNotificationRequest" variable="input_approval_status_sp_email_notification">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:approvalStatus]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:invoke name="invoke_approval_status_sp_email_notification"
			partnerLink="AXNOTIFYPL" operation="sendSubApprovalStatusSPEmailNotification" portType="axnotify:AxiataWorkflowNotificationServicePT"
			inputVariable="input_approval_status_sp_email_notification">
		</bpel:invoke>
		
		<!-- [END] Sub approval status SP email notification. -->
		
		<bpel:assign validate="no" name="assign_au_intput">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<axau:SubApprovalAuditRequest
							xmlns:axau="http://org.wso2.carbon/axiata/workflow/audit"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<axau:requestType>axau:requestType</axau:requestType>
							<axau:apiProvider>axau:apiProvider</axau:apiProvider>
         					<axau:apiName>axau:apiName</axau:apiName>
         					<axau:apiVersion>axau:apiVersion</axau:apiVersion>
         					<axau:appId>axau:appId</axau:appId>
         					<axau:subStatus>axau:subStatus</axau:subStatus>
         					<axau:subApprovalType>axau:subApprovalType</axau:subApprovalType>
         					<axau:completedByRole>axau:completedByRole</axau:completedByRole>
         					<axau:completedByUser>axau:completedByUser</axau:completedByUser>
							<axau:completedOn>axau:completedOn</axau:completedOn>
						</axau:SubApprovalAuditRequest>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="input_sub_approval_audit" part="SubApprovalAuditRequest"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['SUB_APPROVAL_AUDIT_REQUEST']]>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:requestType]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiProvider]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiVersion]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appId]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:subStatus]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['PLUGIN_ADMIN']]>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:subApprovalType]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['admin']]>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByRole]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedByUser]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByUser]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedOn]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedOn]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:invoke name="invoke_sub_approval_audit_insert"
			partnerLink="AAUPL" operation="insertSubApprovalAuditRecord" portType="axau:AxiataWorkflowApprovalAuditServicePT"
			inputVariable="input_sub_approval_audit">
		</bpel:invoke>
	</bpel:sequence>
</bpel:process>

